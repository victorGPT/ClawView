# ClawView v1 字段说明（Display-Only）

> 目标：让用户看懂 OpenClaw 当前运行状态，不提供反向操作。

## 0. 全局约定
- 主时间窗口：**Rolling 24h**
- 辅时间窗口：**Asia/Tokyo 当日**
- 刷新目标：看板数据延迟 **≤ 15 分钟**

### 0.1 字段可采集性门禁（上线前必须过）
- 每个字段必须标注采集状态：
  - **Ready**：已有稳定数据源，可直接展示
  - **Derived**：可由现有事件聚合得到
  - **Gap**：当前没有稳定来源（禁止伪造）
- 首页字段要求：仅允许 `Ready/Derived`，不允许 `Gap` 直接上首页。
- `Gap` 字段展示规则：显示 `--` +「数据未接入」，并记录到缺口清单。
- 首发上线门槛：P0-Core 字段 `Ready/Derived` 覆盖率 >= 98%。

---

## 1. P0 必选字段（首版必须展示）

### A. 系统健康
1. **运行状态**（running / degraded / down）
2. **连续运行时长**（uptime）
3. **24h 重启总数**
4. **24h 计划内重启数**（Planned）
5. **24h 异常重启数**（Unexpected）
6. **24h 未知重启数**（Unknown）
7. **最近一次重启时间**
8. **最近一次重启原因**

### B. 定时任务风险（防止触发风暴）
9. **定时任务总数**
10. **已启用任务数**
11. **24h 触发总次数**
12. **Tokyo 今日触发总次数**
13. **单任务 24h 最高触发次数**
14. **触发最多任务 Top5**（任务名 + 次数）

### C. 对外 API 调用（统一抽象）
15. **调用平台**（如 Lark / Discord / GitHub）
16. **接口分组**（endpoint_group）
17. **Tokyo 今日调用次数**
18. **24h 调用次数**
19. **成功次数**
20. **失败次数**
21. **限速次数（429）**
22. **错误率**（失败/总调用）
23. **最近错误时间**
- **限速信号口径说明**：HTTP 429 + 平台等价限流错误统一计入

### D. 错误可见性
24. **当前活跃错误数**
25. **高频错误 Top10**（错误指纹 + 次数）
26. **每个高频错误首次出现时间**
27. **每个高频错误最近出现时间**
28. **近 1 小时错误增速**

### E. 基础规模（轻量）
29. **Skill 总数**
30. **频道总数**
31. **24h 活跃线程数**（可先近似）

### F. 数据质量信息
32. **数据更新时间**
33. **数据完整性状态**（完整 / 部分缺失 / 延迟）
34. **统计口径标记**（Rolling 24h / Tokyo 当日）

### 1.1 P0-Core 可采集性对照（与 Plan 对齐）
| P0-Core 指标 | 对应展示字段 | 预期数据来源 | 采集状态 |
|---|---|---|---|
| service_uptime_ratio_24h | 运行状态 / 连续运行时长 | 运行时心跳 + 服务存活事件 | Ready |
| service_status_now | 运行状态 | 健康检查事件 | Ready |
| trigger_total_24h | 24h 触发总次数 | cron/job 触发事件 | Ready |
| trigger_storm_task_top5_5m | 触发最多任务 Top5（5m 风险视角） | cron/job 触发事件聚合 | Derived |
| api_call_total_24h | 24h 调用次数 | provider 请求日志 | Ready |
| api_error_rate_24h | 错误率 | provider 请求日志聚合 | Derived |
| api_429_ratio_24h | 限速比例（429） | 429 + 等价限流错误归一化 | Derived |
| endpoint_group_top5_calls_24h | API 分组 TopN | endpoint_group 映射字典 + 请求日志 | Derived |
| error_fingerprint_top10_24h | 高频错误 Top10 | 错误日志 + 指纹归一化 | Derived |
| restart_unexpected_count_24h | 异常重启数 | 进程退出码/崩溃证据 + 重启分类规则 | Derived |
| data_freshness_delay_min | 数据更新时间/延迟状态 | 最新快照时间戳 | Ready |
| p0_core_coverage_ratio | 数据完整性状态 | 字段填充率计算 | Derived |

---

## 2. P1 可选字段（第二阶段）
1. API 调用延迟 P95 / P99
2. Top Caller（按 job/hook/session）
3. 工具调用错误分布（tool error breakdown）
4. 每小时触发热力图（cron/API）

---

## 3. 展示建议（人话优先）
- 使用中文名词，不直接展示代码字段名。

### 3.1 首页 Dashboard（固定模块）
- 首页固定为 5 个模块：
  1) 健康总览（1 行）
  2) 趋势图（2 张：触发趋势、API/限速趋势）
  3) Skill 摘要（TopN）
  4) Cron 摘要（TopN）
  5) API 摘要（TopN）
- 首页不展示全量列表，不展示周/月长周期明细。

### 3.2 首页调用次数口径（固定）
- 主口径：**Rolling 24h 调用次数**
- 辅口径：**Asia/Tokyo 今日调用次数**
- 周/月调用次数：仅在 **API 详情页** 展示

### 3.3 子模块详情页（承载明细）
- Skill/Cron/API/Error 四个子模块承载完整列表和明细分析。
- TopN 之外的内容必须下钻查看。

---

## 4. 告警阈值（v1 建议）
- 单任务 24h 触发 >= 100：黄灯
- 单任务 24h 触发 >= 300：红灯
- 限速比例（429） >= 5%：黄灯
- 限速比例（429） >= 15%：红灯
- 异常重启 >= 2 次/24h：黄灯
- 异常重启 >= 5 次/24h：红灯

---

## 5. 保留策略（已确认）
- 原始快照：保留 **48h**
- 每日压缩快照：长期保留
- 超过 48h 的 raw 自动清理

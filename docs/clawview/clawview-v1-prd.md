# ClawView v1 产品评审 PRD（Display-Only）

- 项目名：ClawView
- 版本：v1
- 状态：Draft for Review
- 日期：2026-02-26
- 适用范围：OpenClaw 运行状态可视化（只展示，不反向操作）

---

## 1. 背景与问题
当前用户难以及时掌握 OpenClaw 运行状态，尤其是：
1) 定时任务触发异常（短时间内大量触发）
2) 对外 API 调用暴涨与限流（例如 Lark）
3) 持续错误未被及时感知
4) 重启是运维行为还是异常崩溃不易区分

目标是提供一个统一看板，帮助用户快速判断“是否健康、哪里异常、是否需要干预”。

---

## 2. 目标（Goals）
1. 用 1 个看板展示 OpenClaw 核心运行状态。
2. 支持“滚动 24h + Tokyo 当日”双口径。
3. 重点发现两类风险：
   - 定时任务触发风暴
   - 对外 API 调用异常/限流
4. 保持 Display-Only，不在看板内提供操作入口。

## 3. 非目标（Non-Goals）
1. 不提供暂停任务/重启服务等控制功能。
2. 不做复杂链路追踪与分布式调试。
3. v1 不做多租户权限系统。

---

## 4. 用户与使用场景
### 用户
- OpenClaw 维护者/操作者（个人或小团队）

### 核心场景
1. 每日巡检：看系统是否稳定
2. 异常排查：确认是否发生触发风暴或 API 限流
3. 复盘分析：查看当天关键风险指标

---

## 5. 指标口径（统一规则）
1. 主窗口：Rolling 24h
2. 辅窗口：Asia/Tokyo 当日（00:00~23:59）
3. 刷新目标：≤15 分钟
4. 所有指标需标注“窗口口径”

---

## 6. v1 必选展示字段（P0）

### A. 系统健康
1. 运行状态（running/degraded/down）
2. 连续运行时长
3. 24h 重启总数
4. 24h 计划内重启数
5. 24h 异常重启数
6. 24h 未知重启数
7. 最近一次重启时间
8. 最近一次重启原因

### B. 定时任务风险
1. 定时任务总数
2. 启用任务数
3. 24h 触发总次数
4. Tokyo 今日触发总次数
5. 单任务 24h 最高触发次数
6. 触发最多任务 Top5（任务名+次数）

### C. 对外 API 调用（统一抽象）
1. 调用平台（Lark/Discord/GitHub/...）
2. 接口分组（endpoint_group）
3. Tokyo 今日调用次数
4. 24h 调用次数
5. 成功次数
6. 失败次数
7. 限速次数（429）
8. 错误率
9. 最近错误时间
10. 限速信号口径（HTTP 429 或平台等价限流错误统一计入）

### D. 错误可见性
1. 当前活跃错误数
2. 高频错误 Top10（错误指纹+次数）
3. 首次出现时间
4. 最近出现时间
5. 近1小时错误增速

### E. Skill 模块（首页摘要 + 详情下钻）
1. Skill 总数
2. Skill 状态分布（正常/告警/异常）
3. Skill 调用总次数（24h）
4. Skill 调用 TopN（默认 5，可配置 6）
5. 每个 Top Skill 的最近调用时间

### F. 规模信息
1. 频道总数
2. 24h 活跃线程数（v1 可近似）

### G. 数据质量
1. 数据更新时间
2. 数据完整性状态（完整/部分缺失/延迟）
3. 统计口径标记（24h/Tokyo）

---

## 7. 页面信息架构（IA）

### 7.1 首页 Dashboard（只放关键信号）
> 原则：首页只回答“现在是否健康、是否有风险、下一步看哪里”。

| 首页模块 | 必须展示的信息 | 数量/条数规则 | 首页禁止展示 |
|---|---|---|---|
| 健康总览条 | 运行状态、异常重启(24h)、限速比例(24h)、活跃错误数 | 固定 1 行 | 明细日志、完整错误列表 |
| 趋势卡 | 24h 触发趋势、24h API 调用/限速趋势 | 固定 2 张图 | 原始事件明细 |
| Skill 摘要卡 | Skill 总数、状态分布、24h 调用总次数、TopN | 手机 Top 5 / Web Top 6 | 80~100+ 全量 Skill |
| Cron 摘要卡 | 任务总数、启用数、今日触发、风险任务 TopN | 手机 Top 3 / Web Top 5 | 全任务逐条明细 |
| API 摘要卡 | API 调用次数（24h 主口径 + Tokyo 今日辅口径）、失败率、限速比例、分组 TopN | 手机 Top 3 / Web Top 5 | 全 endpoint 明细 |

**首页展示规则（强约束）**
1. 排序：风险优先 > 频次优先 > 最近发生时间。
2. 除上述模块外，不新增首页信息块。
3. 每个摘要模块必须提供“查看全部/进入模块详情”。
4. 数据缺失显示 `--` +“数据延迟”，禁止用 `0` 伪装正常。

**首页“调用次数”窗口规则（明确口径）**
1. 首页 API 调用次数主口径：**Rolling 24h**。
2. 首页 API 调用次数辅口径：**Asia/Tokyo 今日（自然日）**。
3. 首页不展示周/月调用次数，避免口径混杂。
4. 周/月口径仅放在 API 详情页中展示（用于复盘与趋势对比）。

### 7.2 侧边栏（子模块详情页）
> 原则：所有“列表型/明细型”信息都放侧边栏模块，不占首页。

| 子模块 | 详情页必须展示的信息 |
|---|---|
| Skill 详情 | 全量 Skill 列表（分页/搜索）、状态分布、调用次数、最近调用时间、单 Skill 趋势/错误率（Phase 2） |
| Cron 详情 | 全任务列表、每任务 24h/今日触发次数、阈值命中状态、任务风险排序 |
| API 详情 | provider + endpoint_group 明细、成功/失败/限速次数、错误率、最近错误时间、周/月调用次数（复盘口径） |
| 错误详情 | 高频错误 Top10、首次/最近出现时间、近 1h 增速、错误指纹聚类 |

### 7.3 首页与侧边栏的边界（避免“揉成一团”）
1. 首页只展示摘要，不展示完整列表。
2. 任何超过 TopN 的内容必须下钻到侧边栏模块。
3. 任何“解释性文字”不超过 1 行，详情说明放模块页。
4. 侧边栏是信息承载主体，首页是状态入口。

### 7.4 Skill 模块 MVP 分期
**Phase 1（首发）**
1. Skill 总数
2. Skill 模块简介（说明“这是技能能力集合状态，不是操作入口”）
3. 24h 调用总次数
4. TopN（默认 5，可配置 6）

**Phase 2（增强）**
1. 全量 Skill 列表（分页/搜索）
2. 单 Skill 调用趋势与错误率
3. 调用明细（按时间/来源筛选）

## 8. 告警规则（v1 建议）
1. 单任务 24h 触发 >= 100：黄灯
2. 单任务 24h 触发 >= 300：红灯
3. 限速比例（429） >= 5%：黄灯
4. 限速比例（429） >= 15%：红灯
5. 异常重启 >= 2 次/24h：黄灯
6. 异常重启 >= 5 次/24h：红灯

---

## 9. 数据保留策略（已确认）
1. 原始快照保留 48h
2. 每日压缩快照长期保留
3. 超过 48h 的 raw 自动清理

---

## 10. 验收标准（AC）
1. 用户可在 10 秒内判断系统是否健康（绿/黄/红）
2. 可在 30 秒内定位是否发生定时任务触发风暴
3. 可在 30 秒内定位 API 限速（429）是否异常
4. 能区分重启是计划内还是异常
5. 看板数据延迟不超过 15 分钟（正常情况下）
6. Skill 模块首页仅展示 TopN（默认 5），并可下钻查看完整明细
7. 首页仅展示轻量摘要，不出现全量列表型内容（Skill/Cron/API/Error 详情下钻）
8. 手机端首页在 2~3 屏内可完成核心巡检（状态、风险、入口）
9. 首页模块数量固定（健康总览、2 张趋势图、Skill 摘要、Cron 摘要、API 摘要），其余信息统一进入侧边栏详情
10. 首页调用次数固定双口径（24h 主 + Tokyo 今日辅），周/月仅在 API 详情页展示

---

## 11. 风险与应对
1. 风险：指标口径不一致导致误判
   - 应对：所有图表和数值强制展示口径标签
2. 风险：错误指纹噪音过大
   - 应对：错误归一化 + TopN 限制
3. 风险：API endpoint 维度爆炸
   - 应对：采用 endpoint_group，不直接用完整 URL

---

## 12. 里程碑（评审视角）
1. M1：PRD 冻结（本文件）
2. M2：计划拆解（任务/验证/上线门槛）
3. M3：本地采集与压缩链路稳定
4. M4：接入 Insforge + 前端首版看板

---

## 13. 术语说明
- 计划内重启（Planned）：运维/升级/配置发布触发
- 异常重启（Unexpected）：崩溃、OOM、异常退出
- 未知重启（Unknown）：无法归因
